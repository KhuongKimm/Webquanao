
@{
    ViewBag.Title = "ThongKeHoaDon";
    Layout = "~/Views/Shared/Admin.cshtml";
}

<head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="~/Scripts/HoaDon/Modify.js"></script>
    <script>

        $(document).ready(function () {
          
            GetAllTTHD();
               $('#xem').click(function(){
                   GetCustomersDate($('#birthday').val());
             })

        
            function GetCustomersDate(a) {
                
                var url = 'https://localhost:44364/api/TTHD/GetCustomersInfoDate/?ngay=' + a
             
                $.ajax({
                    url: url,
                    method: 'GET',
                    contentType: 'json',
                    dataType: 'json',
                    error: function (response) {
                    },
                    success: function (reponse) {

                        var len = reponse.length;

                        let table = '';
                        for (var i = 0; i < len; i++) {

                            table = table + '<tr>';
                            table = table + '<td>' + reponse[i].TenNguoiDung + '</td>';
                            table = table + '<td>' + reponse[i].TenKH + '</td>';
                            table = table + '<td>' + reponse[i].MaHD + '</td>';
                            table = table + '<td>' + reponse[i].TenSP + '</td>';
                            table = table + '<td><img src ="/Images/LayoutData/' + reponse[i].Anh + '" /></td>';

                            table = table + '<td>' + reponse[i].SoLuong + '</td>';
                            table = table + '<td>' + reponse[i].Gia + '</td>';
                            table = table + '<td>' + reponse[i].NgayDat + '</td>';
                            table = table + '<td>' + '<button type="button" class="btn btn-danger update-button" onclick="deleteHD(' + "'" + reponse[i].MaHD + "'" + ',' + "'" + reponse[i].MaSP + "'" + ');">' + "Hủy" + '</button>' + '</td>';
                            table = table + '</tr>';
                        }
                        $('#allKH').html(table);

                    },
                    fail: function (response) {
                    }
                });
            }
              
            function GetCustomersProductSale(a) {
                var url = 'https://localhost:44364/api/TTHD/GetCustomersProduct/';
                if (a != null) url = 'https://localhost:44364/api/TTHD/GetCustomersProduct/?TenSP=' + a
                $.ajax({
                    url: url,
                    method: 'GET',
                    contentType: 'json',
                    dataType: 'json',
                    error: function (response) {
                    },
                    success: function (reponse) {

                        var len = reponse.length;

                        let table = '';
                        for (var i = 0; i < len; i++) {

                            table = table + '<tr>';
                            table = table + '<td>' + reponse[i].MaSP + '</td>';
                            table = table + '<td>' + reponse[i].TenSP + '</td>';
                            table = table + '<td>' + reponse[i].SLBan + '</td>';
                            table = table + '</tr>';
                        }
                        $('#allKH').html(table);

                    },
                    fail: function (response) {
                    }
                });
            }
            function GetCustomersProductTop(a) {
                var url = 'https://localhost:44364/api/TTHD/GetCustomersProductTop/?top=' + a;

                if (a.length == 0) url = 'https://localhost:44364/api/TTHD/GetCustomersProduct/';
                $.ajax({
                    url: url,
                    method: 'GET',
                    contentType: 'json',
                    dataType: 'json',
                    error: function (response) {
                    },
                    success: function (reponse) {

                        var len = reponse.length;

                        let table = '';
                        for (var i = 0; i < len; i++) {

                            table = table + '<tr>';
                            table = table + '<td>' + reponse[i].MaSP + '</td>';
                            table = table + '<td>' + reponse[i].TenSP + '</td>';
                            table = table + '<td>' + reponse[i].SLBan + '</td>';
                            table = table + '</tr>';
                        }
                        $('#allKH').html(table);

                    },
                    fail: function (response) {
                    }
                });
            }
     /*      ------------------------------------------------------------------------*/
            $('#txtFindTenTK_HD').on('input', function (e) { 
                GetAllTTHD($('#txtFindTenTK_HD').val().toString())
                if ($('#txtFindTenTK_HD').val().toString()=="") {
                    GetAllTTHD();
                }
            });

            $('#txtFindTenTK_TK').on('input', function (e) {
                GetCustomersSum($('#txtFindTenTK_TK').val().toString())
                if ($('#txtFindTenTK_TK').val().toString() == "") {
                    GetCustomersSum();
                }
            });
            $('#txtFindTenTK_SP').on('input', function (e) {
                GetCustomersProductSale($('#txtFindTenTK_SP').val().toString())
                if ($('#txtFindTenTK_SP').val().toString() == "") {
                    GetCustomersProductSale();
                }
            });
            $('#TKKHTOP').on('input', function (e) {
                GetCustomersSumTop($('#TKKHTOP').val().toString())
            });
      
            $('#TKSPTOP').on('input', function (e) {
                GetCustomersProductTop($('#TKSPTOP').val().toString())
            });
            $('#CTHD').click(function () {
                GetAllTTHD();
                var luu1 = $('#CTHD').text();
                $('#Menu').text(luu1);
                $('#tableTK').css('display', 'none')
                $('#tableSP').css('display', 'none')
                $('#tableCTHD').css('display', 'contents')
                $('#txtFindTenTK_TK').css('display', 'none')
                $('#txtFindTenTK_SP').css('display', 'none')
                $('#txtFindTenTK_HD').css('display', 'block')
                $('#TKKHTOP').css('display', 'none')
                $('#TKSPTOP').css('display', 'none')
                $('#CTHDTheoNgay').css('display', 'inline')

            });
            $('#TK').click(function () {
                  GetCustomersSum();
               
                var luu1 = $('#TK').text();
                $('#Menu').text(luu1);
                $('#tableCTHD').css('display', 'none')
                $('#tableSP').css('display', 'none')
                $('#tableTK').css('display', 'contents')
                $('#txtFindTenTK_HD').css('display', 'none')
                $('#txtFindTenTK_SP').css('display', 'none')
                $('#txtFindTenTK_TK').css('display', 'block')
                $('#TKKHTOP').css('display', 'inline')
                $('#TKSPTOP').css('display', 'none')
                $('#CTHDTheoNgay').css('display', 'none')

            });
            $('#TKSP').click(function () {

                GetCustomersProductSale();
               
                var luu1 = $('#TKSP').text();
                $('#Menu').text(luu1);
                $('#tableCTHD').css('display', 'none')
                $('#tableTK').css('display', 'none')
                $('#tableSP').css('display', 'contents')
                $('#txtFindTenTK_HD').css('display', 'none')
                $('#txtFindTenTK_TK').css('display', 'none')
                $('#txtFindTenTK_SP').css('display', 'block')
                $('#TKKHTOP').css('display', 'none')
                $('#CTHDTheoNgay').css('display', 'none')
                $('#TKSPTOP').css('display', 'inline')

            });
        })
    </script>
    <style>
        #CTHDTheoNgay {
            display:inline;
        }
        #TKKHTOP {
            display: none;
        }
        #TKSPTOP {
            display: none;
        }
        #tableTK {
            display: none;
        }
        #tableSP{
            display:none;
        }
        th {
            text-align: center;
        }
        td {
            text-align: center;
        }
        img{
            width:100px;
        }
        #txtFindTenTK_TK {
            display:none;
        }
        #txtFindTenTK_SP{
            display:none;
        }
    </style>
</head>
<body>

    <div class="container-fluid">
        <div>
            <div class="input-group custom-search-form" style="margin-top:10px;">
                <input id="txtFindTenTK_HD" type="text" class="form-control" placeholder="Search.">
                <input id="txtFindTenTK_TK" type="text" class="form-control" placeholder="Search.">
                <input id="txtFindTenTK_SP" type="text" class="form-control" placeholder="Search.">
                <span class="input-group-btn">
                    <button class="btn btn-default" type="button">
                        <i class="fa fa-search"></i>
                    </button>
                </span>
            </div>
           
        
            <div style="margin:20px 0px;" class="dropdown">
                <button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
                    <a href="#" style="text-decoration:none;" id="Menu">Menu</a>
                    <span class="caret"></span>
                </button>
                <span><input style="margin-left:340px;width:250px; " id="TKKHTOP" type="text" class="form-control" placeholder="Nhập số lượng top thống kê" /></span>
                <span><input style="margin-left:340px;width:250px; " id="TKSPTOP" type="text" class="form-control" placeholder="Nhập số lượng top thống kê" /></span>
                <span>
                    <form style="margin-left:340px;width:250px"; id="CTHDTheoNgay"  >
                        @*<label for="birthday">Birthday:</label>*@
                        <input type="date" id="birthday" name="birthday">
                        <button type="button" id="xem" class="btn btn-primary"  >Xem</button>
                    </form>
                </span>
            

                <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
                    <li><a href="#" id="CTHD">Chi Tiết HD</a></li>
                    <li><a href="#" id="TK">Thống kê</a></li>
                    <li><a href="#" id="TKSP">Sản Phẩm  Bán Chạy</a></li>
                </ul>
            </div>
        </div>


        <div class="row">

            <div class="col-lg-12" style="overflow:scroll; height:500px" >
                <div class="table-responsive">
                    <table class="table table-striped table-bordered table-hover">
                        <thead>
                            <tr id="tableCTHD">
                                <th>Tên người dùng</th>
                                <th>Tên khách hàng</th>
                                <th>Ma hóa đơn</th>
                                <th>Tên sản phẩm</th>
                                <th>Ảnh</th>
                                <th>Số lượng</th>
                                <th>Giá</th>
                                <th>Ngày đặt</th>
                                <th>Hủy đơn</th>
                            </tr>
                            <tr id="tableTK">
                                <th>Mã KH</th>
                                <th>Tên Khách Hàng</th>
                                <th>Tên Người Dùng</th>
                                <th>Số Điện Thoại</th>
                                <th>Tổng Tiền</th>
                            </tr>
                            <tr id="tableSP">
                                <th>Mã sản phẩm</th>
                                <th>Tên sản phẩm</th>
                                <th>Tổng số lượng bán</th>
                              
                            </tr>
                        </thead>

                        <tbody id="allKH">
                        </tbody>
                    </table>
                </div>


            </div>
        </div>

    </div>

</body>